--- 
layout: post
title: LibGDX Tutorial - A Running Game with libGDX - Part 1
date: "2014-06-07T10:02:00.000-03:00"
author: William Mora
tags: 
- Google Play
- Java
- software development
- libGDX
- video games
- Android
permalink: /2014/06/a-running-game-with-libgdx-part-1.html
---

I've always liked 2d running games. When I first got an Android phone, I played&nbsp;<a href="https://play.google.com/store/apps/details?id=com.droidhen.irunner" target="_blank">iRunner</a>&nbsp;for hours, and at the time I seriously wanted to develop a game like that. A lot of time has passed since but I finally had the time to put together a&nbsp;simple, running game&nbsp;using&nbsp;<a href="http://libgdx.badlogicgames.com/" target="_blank">libGDX</a>. A final version based on this tutorial is on <a href="https://play.google.com/store/apps/details?id=com.gamestudio24.cityescape.android" target="_blank">Google Play</a>.<br /><br />LibGDX is one of the nicest projects I've followed over the past few years and when I began looking into different video game development frameworks, it was definitely the one that provided the most features and provided the best performance for my then crappy phone :). If you have time, I recommend reading its creator's <a href="http://www.badlogicgames.com/wordpress/?p=3412" target="_blank">post</a> on releasing version 1.0.<br /><br />I developed this game as a learning exercise using libGDX's <a href="https://github.com/libgdx/libgdx/wiki/Scene2d" target="_blank">scene2d</a> and <a href="https://github.com/libgdx/libgdx/wiki/Box2d" target="_blank">box2d</a> libraries on my spare time. The code is by no means perfect, but I hope it helps you get on the right track if you are looking to develop The Next Awesome Game. Also, even though libGDX is a cross-platform framework, I only targeted Android as my final release platform and I targeted desktop for testing purposes.<br /><br /><b><i>NOTE: I won't be explaining much related to libGDX or box2d as they already have excellent documentation. I'm only guiding you through my own implementation of a game using these tools. If you don't understand why I'm using a particular class or what a physics body is I strongly suggest taking a look at libGDX's&nbsp;<a href="https://github.com/libgdx/libgdx/wiki" target="_blank">wiki</a>&nbsp;before moving forward.</i></b><br /><br />This tutorial guides you through the basics of how I implemented the game. The code from these posts is on <a href="https://github.com/wmora/cityescape" target="_blank">GitHub</a>.You are free to use it as you wish.<br /><br />Before we start writing any code, let's take a look at the game concept.<br /><br /><h2>City Escape!</h2><div>This is the silly story I came up with: You are an alien and giant insects are attacking your city! Your goal is to escape by running as much as you can while avoiding all insects.<br /><br /></div><h2>Game Controls</h2><div>There are only to ways of avoiding insects: jumping and dodging. The jump button will be the right side of the screen and the dodge button will be the left side of the screen.</div><div><span style="background-color: yellow;"><br /></span>With our awesome design done, let's build the game!<br /><br /></div><h2>Creating the Project</h2><div>Let's&nbsp;<a href="https://github.com/libgdx/libgdx/wiki/Setting-up-your-Development-Environment-%28Eclipse%2C-Intellij-IDEA%2C-NetBeans%29" target="_blank">set up a new project</a>&nbsp;using the gdx-setup tool they offer. We'll be using box2d, so make sure to include the extension during the setup. Like I said before, I'm only targeting Android as my build platform and will use desktop for testing, so no iOS or HTML.<br /><br />This is what my setup looks like:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-pXLS5T-ahIs/U2bI47O-e0I/AAAAAAAAFEs/Fl1LA_wUW0c/s1600/Screen+Shot+2014-05-04+at+8.09.47+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-pXLS5T-ahIs/U2bI47O-e0I/AAAAAAAAFEs/Fl1LA_wUW0c/s1600/Screen+Shot+2014-05-04+at+8.09.47+PM.png" height="320" width="275" /></a></div><br /></div><div><span id="goog_1989507606"></span><span id="goog_1989507607"></span>Once you click on <b>Generate</b> the Gradle <code>clean</code>&nbsp;command will run and all libraries will be downloaded. You should see an output like the following:<br /><br /></div><pre>Generating app in /Users/wilmor24/Documents/idea/cityescape<br />Executing '/Users/wilmor24/Documents/idea/cityescape/gradlew clean'<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-platform/1.0.0/gdx-platform-1.0.0.pom<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-parent/1.0.0/gdx-parent-1.0.0.pom<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-box2d-platform/1.0.0/gdx-box2d-platform-1.0.0.pom<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-platform/1.0.0/gdx-platform-1.0.0-natives-armeabi.jar<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-platform/1.0.0/gdx-platform-1.0.0-natives-armeabi-v7a.jar<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-platform/1.0.0/gdx-platform-1.0.0-natives-x86.jar<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-box2d-platform/1.0.0/gdx-box2d-platform-1.0.0-natives-armeabi.jar<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-box2d-platform/1.0.0/gdx-box2d-platform-1.0.0-natives-armeabi-v7a.jar<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-box2d-platform/1.0.0/gdx-box2d-platform-1.0.0-natives-x86.jar<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-backend-android/1.0.0/gdx-backend-android-1.0.0.pom<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-box2d/1.0.0/gdx-box2d-1.0.0.pom<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-box2d-parent/1.0.0/gdx-box2d-parent-1.0.0.pom<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx/1.0.0/gdx-1.0.0.pom<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx/1.0.0/gdx-1.0.0.jar<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-box2d/1.0.0/gdx-box2d-1.0.0.jar<br />Download http://repo1.maven.org/maven2/com/badlogicgames/gdx/gdx-backend-android/1.0.0/gdx-backend-android-1.0.0.jar<br />:android:clean UP-TO-DATE<br />:core:clean UP-TO-DATE<br />:desktop:clean UP-TO-DATE<br /><br />BUILD SUCCESSFUL<br /><br />Total time: 30.126 secs<br />Done!<br />To import in Eclipse: File -&gt; Import -&gt; Gradle -&gt; Gradle Project<br />To import to Intellij IDEA: File -&gt; Import -&gt; build.gradle<br />To import to NetBeans: File -&gt; Open Project...</pre><br />I won't go over importing the project into an IDE since it's part of a libGDX project setup and it is up to you which IDE to use (in case you are wondering, I'm using IntelliJ IDEA 13 at the time of this writing).<br /><br />After successfully running the game in both desktop and Android, I usually clean up the boilerplate code set up by libGDX. That means, deleting the image <code>badlogic.jpg</code> that is added to the <code>assets</code>&nbsp;folder and leaving my game class like the following:<br /><br /><pre>package com.gamestudio24.cityescape;<br /><br />import com.badlogic.gdx.ApplicationAdapter;<br /><br />public class CityEscape extends ApplicationAdapter {<br /><br />    @Override<br />    public void create() {<br /><br />    }<br /><br />    @Override<br />    public void render() {<br /><br />    }<br />}</pre><h2>Getting Started</h2><div>The first thing we'll do is to make our game class extend <code>Game</code> so we can support multiple screens. We won't be using multiple screens for this game but I suggest doing this part in case you want to add multiple screens in the future, e.g. for a splash screen, separate menu screen, leaderboards, etc.</div><div><br /></div>My game class now looks like this:<br /><br /><pre>package com.gamestudio24.cityescape;<br /><br /><b>import com.badlogic.gdx.Game;</b><br /><br />public class CityEscape <b>extends Game </b>{<br /><br />    @Override<br />    public void create() {<br /><br />    }<br /><br /><b>    // Get rid of render function, let the parent class handle it</b><br /><br />}<br /></pre><br />Now create a <code>GameScreen</code> class inside a newly created <code>screens</code> package:<br /><br /><i><b>NOTE: Assume all classes/packages are being added/modified inside our core&nbsp;module unless otherwise noted</b></i><br /><br /><pre>package com.gamestudio24.cityescape.screens;<br /><br />import com.badlogic.gdx.Screen;<br /><br />public class GameScreen implements Screen {<br /><br />    @Override<br />    public void render(float delta) {<br />     <br />    }<br /><br />    @Override<br />    public void resize(int width, int height) {<br /><br />    }<br /><br />    @Override<br />    public void show() {<br /><br />    }<br /><br />    @Override<br />    public void hide() {<br /><br />    }<br /><br />    @Override<br />    public void pause() {<br /><br />    }<br /><br />    @Override<br />    public void resume() {<br /><br />    }<br /><br />    @Override<br />    public void dispose() {<br /><br />    }<br /><br />}<br /></pre><br />Once created, we need to make our game class set our <code>GameScreen</code> on startup.<br /><br /><pre>package com.gamestudio24.cityescape;<br /><br />import com.badlogic.gdx.Game;<br /><b>import com.gamestudio24.cityescape.screens.GameScreen;</b><br /><br />public class CityEscape extends Game {<br /><br />    @Override<br />    public void create() {<br /><b>        setScreen(new GameScreen());</b><br />    }<br /><br />}<br /></pre><br />The last thing we need to do for our setup is to set the height and width of our game. We'll make this game 480x800. Let's store these values in a <code>Constants</code> class inside a <code>utils</code> package.<br /><br /><pre>package com.gamestudio24.cityescape.utils;<br /><br />public class Constants {<br /><br />    public static final int APP_WIDTH = 800;<br />    public static final int APP_HEIGHT = 480;<br /><br />}<br /></pre><br />Finally, configure our <code>DesktopLauncher</code> so it uses the correct measurements:<br /><pre>package com.gamestudio24.cityescape.desktop;<br /><br />import com.badlogic.gdx.backends.lwjgl.LwjglApplication;<br />import com.badlogic.gdx.backends.lwjgl.LwjglApplicationConfiguration;<br />import com.gamestudio24.cityescape.CityEscape;<br /><b>import com.gamestudio24.cityescape.utils.Constants;</b><br /><br />public class DesktopLauncher {<br /> public static void main (String[] arg) {<br />  LwjglApplicationConfiguration config = new LwjglApplicationConfiguration();<br /><b>        config.width = Constants.APP_WIDTH;<br />        config.height = Constants.APP_HEIGHT;</b><br />  new LwjglApplication(new CityEscape(), config);<br /> }<br />}<br /></pre>Go ahead and run the project. So far, we have set up a game with a screen running on a 480x800 window.<br /><br /><h2>A Stage for a Physics World</h2><div>Now we'll start creating our physics world. It'll consist of a <i>ground,</i>&nbsp;a <i>runner</i>, and <i>enemies</i>. Even though our runner will be the one running through the city, we won't be actually moving our runner body along the x-axis but make the enemies move towards the runner to while giving the illusion he is moving forward with sprite animations.</div><div><br /></div><div>Box2d makes it easy to control bodies and control their physics, such as jumping, colliding, moving, etc. If you don't know box2d at all, I recommend taking a quick look at its <a href="http://www.box2d.org/manual.html" target="_blank">documentation</a>.</div><div><br /></div><div>Our bodies will be created as follows:</div><div><ul><li>Ground: Static body</li><li>Runner: Dynamic body</li><li>Enemies: Kinematic bodies</li></ul>Let's make a class that takes care of creating our bodies. Create a <code>WorldUtils</code>&nbsp;class inside our <code>utils</code>&nbsp;package and create a function to set up the ground.<br /><pre>package com.gamestudio24.cityescape.utils;<br /><br />import com.badlogic.gdx.math.Vector2;<br />import com.badlogic.gdx.physics.box2d.Body;<br />import com.badlogic.gdx.physics.box2d.BodyDef;<br />import com.badlogic.gdx.physics.box2d.PolygonShape;<br />import com.badlogic.gdx.physics.box2d.World;<br /><br />public class WorldUtils {<br /><br />    public static World createWorld() {<br />        return new World(Constants.WORLD_GRAVITY, true);<br />    }<br /><br />    public static Body createGround(World world) {<br />        BodyDef bodyDef = new BodyDef();<br />        bodyDef.position.set(new Vector2(Constants.GROUND_X, Constants.GROUND_Y));<br />        Body body = world.createBody(bodyDef);<br />        PolygonShape shape = new PolygonShape();<br />        shape.setAsBox(Constants.GROUND_WIDTH / 2, Constants.GROUND_HEIGHT / 2);<br />        body.createFixture(shape, Constants.GROUND_DENSITY);<br />        shape.dispose();<br />        return body;<br />    }<br /><br />}<br /></pre><br />The new constants added to our <code>Constants</code> class are the following: <br /><br /><pre>package com.gamestudio24.cityescape.utils;<br /><br /><b>import com.badlogic.gdx.math.Vector2;</b><br /><br />public class Constants {<br /><br />    public static final int APP_WIDTH = 800;<br />    public static final int APP_HEIGHT = 480;<br /><br />    <b>public static final Vector2 WORLD_GRAVITY = new Vector2(0, -10);<br /><br />    public static final float GROUND_X = 0;<br />    public static final float GROUND_Y = 0;<br />    public static final float GROUND_WIDTH = 25f;<br />    public static final float GROUND_HEIGHT = 2f;<br />    public static final float GROUND_DENSITY = 0f;</b><br /><br />}<br /></pre><br />Let's take a look at what we just did. We defined a utility class <code>WorldUtils</code> which will take care of creating our world components. For now we'll only create the ground and the world itself. The ground is created as a static body with a length of 25 meters and a height of 2 meters and it is created as a box. In fact, all of our bodies will be boxes of different shapes.<br /><br />The world is created with a gravity of -10 m/s^2. Box2d works best when using real physics values. In fact, the documentation warns the engine to be buggy if using exaggerated world values.<br /><br />Ok, so we have these functions to create a world and the ground, but where do we use them? We could use them inside our <code>GameScreen;</code> instead, we will add them to a&nbsp;<code>Stage</code> which will be added to the <code>GameScreen</code>. A <code>Stage</code> is part of scene2d and is an input processor that can hold many <code>Actor</code> objects and handle their drawing and input events. We will add Actors later on but it is better to set up the <code>Stage</code> now so we don't have to move the code from the <code>GameScreen</code> later on.<br /><br />Create a <code>GameStage</code> inside a <code>stages</code> package. This class will extend libGDX's <code>Stage</code> class. In the constructor, we'll use our <code>WorldUtils</code> class to create the world and the ground. At this point, we will be using the <code>Box2DDebugRenderer</code> to display what we have created so far. We'll use sprites later on once we are comfortable with the physics. The code is the following:<br /><br /><pre>package com.gamestudio24.cityescape.stages;<br /><br />import com.badlogic.gdx.graphics.OrthographicCamera;<br />import com.badlogic.gdx.physics.box2d.Body;<br />import com.badlogic.gdx.physics.box2d.Box2DDebugRenderer;<br />import com.badlogic.gdx.physics.box2d.World;<br />import com.badlogic.gdx.scenes.scene2d.Stage;<br />import com.gamestudio24.cityescape.utils.WorldUtils;<br /><br />public class GameStage extends Stage {<br /><br />    // This will be our viewport measurements while working with the debug renderer<br />    private static final int VIEWPORT_WIDTH = 20;<br />    private static final int VIEWPORT_HEIGHT = 13;<br /><br />    private World world;<br />    private Body ground;<br /><br />    private final float TIME_STEP = 1 / 300f;<br />    private float accumulator = 0f;<br /><br />    private OrthographicCamera camera;<br />    private Box2DDebugRenderer renderer;<br /><br />    public GameStage() {<br />        world = WorldUtils.createWorld();<br />        ground = WorldUtils.createGround(world);<br />        renderer = new Box2DDebugRenderer();<br />        setupCamera();<br />    }<br /><br />    private void setupCamera() {<br />        camera = new OrthographicCamera(VIEWPORT_WIDTH, VIEWPORT_HEIGHT);<br />        camera.position.set(camera.viewportWidth / 2, camera.viewportHeight / 2, 0f);<br />        camera.update();<br />    }<br /><br />    @Override<br />    public void act(float delta) {<br />        super.act(delta);<br /><br />        // Fixed timestep<br />        accumulator += delta;<br /><br />        while (accumulator &gt;= delta) {<br />            world.step(TIME_STEP, 6, 2);<br />            accumulator -= TIME_STEP;<br />        }<br /><br />        //TODO: Implement interpolation<br /><br />    }<br /><br />    @Override<br />    public void draw() {<br />        super.draw();<br />        renderer.render(world, camera.combined);<br />    }<br /><br />}<br /></pre><br />You probably noticed the <i>Fixed timestep</i> comment inside the <code>render</code>&nbsp;function. Like the libGDX box2d documentation says, stepping the simulation is a topic itself. I followed&nbsp;<a href="http://gafferongames.com/game-physics/fix-your-timestep/" target="_blank">this</a>&nbsp;article to implement my version of fixed timestep. We probably need to implement interpolation as well, but I'll leave it as a TODO for now.<br /><br />Finally, let's launch our <code>GameStage</code>&nbsp;inside our <code>GameScreen</code>. We'll be calling <code>act</code> and <code>draw</code>&nbsp;inside the <code>render</code>&nbsp;function:<br /><br /><pre>package com.gamestudio24.cityescape.screens;<br /><br /><b>import com.badlogic.gdx.Gdx;</b><br />import com.badlogic.gdx.Screen;<br /><b>import com.badlogic.gdx.graphics.GL20;<br />import com.gamestudio24.cityescape.stages.GameStage;</b><br /><br />public class GameScreen implements Screen {<br /><br />    <b>private GameStage stage;<br /><br />    public GameScreen() {<br />        stage = new GameStage();<br />    }</b><br /><br />    @Override<br />    public void render(float delta) {<br />        <b>//Clear the screen<br />        Gdx.gl.glClear(GL20.GL_COLOR_BUFFER_BIT);<br /><br />        //Update the stage<br />        stage.draw();<br />        stage.act(delta);</b><br />    }<br /><br />    //Rest of the code<br />    ...<br /><br />}<br /></pre><br />Run the game and you'll see a green line at the bottom which is the outline of the box we added to our world (the ground). Your game should look like the image below:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-HxbwNQrriMc/U2cQmnDHZxI/AAAAAAAAFE8/xnMD1_ZIwuw/s1600/Screen+Shot+2014-05-05+at+1.15.32+AM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img alt="World with ground" border="0" src="http://2.bp.blogspot.com/-HxbwNQrriMc/U2cQmnDHZxI/AAAAAAAAFE8/xnMD1_ZIwuw/s1600/Screen+Shot+2014-05-05+at+1.15.32+AM.png" height="201" title="World with ground" width="320" /></a></div><br />In the <a href="http://www.williammora.com/2014/06/a-running-game-with-libgdx-part-2.html">next part</a>, we'll add our runner with some basic controls.<br /><br />If you have any questions or comments, feel free to let me know in the comments section. Cheers! </div>